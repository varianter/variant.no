import anime from "animejs";
import React, { useEffect, useRef, useState } from "react";
import Layout from "src/layout";
import RadioButton from "../components/radio-button";
import Slider from "../components/slider";
import calculateEstimatedSalaray from "./calculate";
import style from "./index.module.css";

const SalaryCalculator = () => {
  return (
    <Layout>
      <div className={style.wrapper}>
        <Calculator />
      </div>
    </Layout>
  );
};

export default SalaryCalculator;

type Degree = "masters" | "bachelor";

const Calculator = () => {
  const [degree, setDegree] = useState<Degree>("masters");
  const [selectedYear, setSelectedYear] = useState(2009);
  const containerRef = useRef(null);
  const maxYear = new Date().getFullYear();

  const [salary, setSalary] = useState("0");

  const formatCurrency = (pay: string | undefined) => {
    if (!pay) return pay;
    return new Intl.NumberFormat("nb-NO").format(parseInt(pay));
  };

  useEffect(() => {
    var pay = calculateEstimatedSalaray(selectedYear, degree);

    anime({
      targets: salary,
      value: pay,
      duration: 100,
      round: 1,
      easing: "easeInOutExpo",
      update: function () {
        setSalary(formatCurrency(pay) ?? "Kunne ikke regne ut");
      },
    });
  }, [selectedYear, degree, salary]);

  // useEffect(() => {
  //   //Could be commented out while developing
  //   anime({
  //     targets: ".path",
  //     d: [
  //       {
  //         value: [
  //           "M116.5,-111.9C137.2,-67.1,130.5,-19.4,116.1,19.7C101.8,58.8,79.7,89.3,37.8,128.9C-4.199999999999999,168.5,-66.1,217.1,-103.8,203.6C-141.6,190,-155.1,114.3,-163.6,46.2C-172.1,-21.9,-175.6,-82.4,-147.5,-128.9C-119.4,-175.5,-59.7,-208.3,-5.9,-203.6C48,-198.9,95.9,-156.8,116.5,-111.9Z",
  //           "M154.1,-117.5C182,-87.8,174.9,-24.8,152.9,20.2C130.9,65.2,94.1,92,56.9,104.7C19.8,117.4,-17.6,115.9,-66.5,105.1C-115.4,94.2,-175.7,74,-189,37C-202.4,-0.10000000000000142,-168.8,-54,-129.5,-86.3C-90.2,-118.6,-45.1,-129.3,9,-136.5C63.1,-143.6,126.1,-147.3,154.1,-117.5Z",
  //         ],
  //       },
  //       {
  //         value:
  //           "M150.4,-125.9C184.5,-77.1,194.6,-15.2,185.2,48.8C175.8,112.8,146.9,179,91.2,216.1C35.4,253.2,-47.1,261.3,-104,228.9C-160.9,196.6,-192.1,123.8,-208.5,48.5C-224.9,-26.7,-226.6,-104.4,-189.4,-153.9C-152.2,-203.4,-76.1,-224.7,-9,-217.5C58.1,-210.3,116.2,-174.7,150.4,-125.9Z",
  //       },
  //       {
  //         value:
  //           "M140.6,-134.6C162.8,-84.2,148.2,-26.9,138.7,38.5C129.2,103.8,124.9,177.1,89.9,198.6C54.8,220.1,-11,189.8,-78.2,158.8C-145.4,127.8,-214.1,96.2,-229.7,46.9C-245.3,-2.3000000000000007,-207.9,-69.1,-160.7,-125.2C-113.6,-181.3,-56.8,-226.6,1.1999999999999993,-227.6C59.2,-228.5,118.3,-185,140.6,-134.6Z",
  //       },
  //       {
  //         value:
  //           "M160.2,-119.1C190.1,-90.3,184.7,-24.7,162.7,23.1C140.6,70.8,101.7,100.7,54.8,129.4C7.800000000000001,158,-47.3,185.3,-78.1,168.2C-108.9,151,-115.4,89.4,-121.2,35.7C-127.1,-18,-132.4,-63.9,-112,-90.5C-91.7,-117.2,-45.9,-124.6,9.6,-132.3C65.2,-140,130.3,-147.9,160.2,-119.1Z",
  //       },
  //       {
  //         value:
  //           "M105.1,-91.6C140.8,-39,177.7,5,181.4,62.5C185.1,120,155.7,191.1,101,222.3C46.3,253.5,-33.7,244.8,-97.5,210.8C-161.3,176.9,-208.8,117.7,-214.8,58.5C-220.7,-0.7000000000000002,-185,-59.9,-142.3,-114.1C-99.6,-168.4,-49.8,-217.7,-7.6,-211.7C34.7,-205.6,69.3,-144.3,105.1,-91.6Z",
  //       },
  //       {
  //         value:
  //           "M116.5,-111.9C137.2,-67.1,130.5,-19.4,116.1,19.7C101.8,58.8,79.7,89.3,37.8,128.9C-4.199999999999999,168.5,-66.1,217.1,-103.8,203.6C-141.6,190,-155.1,114.3,-163.6,46.2C-172.1,-21.9,-175.6,-82.4,-147.5,-128.9C-119.4,-175.5,-59.7,-208.3,-5.9,-203.6C48,-198.9,95.9,-156.8,116.5,-111.9Z",
  //       },
  //     ],
  //     easing: "easeOutBack",
  //     duration: 55000,
  //     loop: true,
  //   });
  //   anime({
  //     targets: ".top-path",
  //     d: [
  //       {
  //         value: [
  //           "M136.6,-181.3C183.8,-153.7,233.59999999999997,-122.9,248.4,-80.1C263.1,-37.3,242.8,17.5,201.7,41.2C160.5,64.9,98.5,57.5,61.400000000000006,61.5C24.299999999999997,65.4,12.100000000000001,80.7,-21.5,110.2C-55.1,139.8,-110.1,183.6,-132.6,174.9C-155.1,166.2,-145.1,105,-151.3,56.2C-157.6,7.3,-180.1,-29.3,-167.1,-49.6C-154.1,-70,-105.5,-74.3,-71.8,-106.3C-38,-138.3,-19,-198.2,12.8,-215.8C44.7,-233.5,89.3,-209,136.6,-181.3Z",
  //           "M73.4,-111.5C98.6,-82.7,124.9,-65.9,152,-36.6C179.1,-7.300000000000001,207,34.5,192.4,57.3C177.8,80,120.6,83.7,81.5,87.1C42.3,90.6,21.2,93.8,-7.199999999999999,103.6C-35.5,113.5,-70.9,130,-116.1,128.5C-161.3,127,-216.2,107.5,-233.8,71.6C-251.4,35.7,-231.7,-16.6,-202.8,-53.6C-173.9,-90.7,-135.7,-112.5,-100.4,-138C-65,-163.5,-32.5,-192.8,-4.200000000000001,-187C24.1,-181.2,48.2,-140.3,73.4,-111.5Z",
  //         ],
  //       },
  //       {
  //         value:
  //           "M129.8,-178.8C163.5,-154.1,183.1,-110,179.3,-70.3C175.6,-30.7,148.7,4.399999999999999,136.9,45.6C125,86.8,128.4,134,108.1,156.7C87.8,179.5,43.9,177.7,14,158.5C-15.9,139.2,-31.7,102.4,-72.6,86.3C-113.5,70.3,-179.5,75,-211.1,51.2C-242.8,27.4,-240.3,-24.9,-215.9,-60.9C-191.4,-96.8,-145.1,-116.4,-105.5,-139.2C-65.8,-161.9,-32.9,-188,7.5,-198.4C48,-208.7,96,-203.5,129.8,-178.8Z",
  //       },
  //       {
  //         value:
  //           "M119.7,-160.2C161.4,-134.4,205.7,-107.8,200.4,-76.4C195,-45,139.8,-8.8,123.9,40.3C108,89.3,131.3,151,117.2,167.6C103.1,184.2,51.5,155.6,-1.5999999999999996,157.7C-54.7,159.9,-109.3,192.8,-139,181.3C-168.6,169.7,-173.2,113.8,-175.1,66.7C-176.9,19.6,-175.9,-18.6,-172.7,-64.5C-169.4,-110.4,-163.7,-164,-134.6,-193.9C-105.4,-223.8,-52.7,-229.9,-6.9,-220.4C39,-211,78,-186,119.7,-160.2Z",
  //       },
  //       {
  //         value:
  //           "M137.4,-163.8C176.1,-161,204.1,-118.2,189.5,-80.9C175,-43.7,117.9,-11.9,104.8,35.8C91.7,83.6,122.6,147.4,112.4,156.7C102.3,166.1,51.1,121.1,9.1,108.5C-32.9,96,-65.8,115.9,-92.6,112C-119.4,108,-140.1,80.1,-138,52.8C-136,25.4,-111.3,-1.3,-95.7,-25.4C-80,-49.5,-73.5,-70.9,-59.099999999999994,-81.5C-44.7,-92.19999999999999,-22.299999999999997,-92.1,13.5,-110.69999999999999C49.4,-129.3,98.7,-166.6,137.4,-163.8Z",
  //       },
  //       {
  //         value:
  //           "M134.4,-209C152.8,-171.6,131.5,-103.7,138.5,-52.1C145.5,-0.5,180.7,34.8,173.9,56.7C167,78.6,118.2,87,82.2,99.2C46.2,111.3,23.1,127.2,-10.6,141.7C-44.3,156.3,-88.6,169.6,-131.7,159.7C-174.8,149.9,-216.7,117,-217.3,79.1C-217.8,41.3,-176.9,-1.3999999999999986,-142.5,-27.5C-108.1,-53.5,-80.2,-62.7,-57.5,-98.7C-34.89999999999999,-134.7,-17.4,-197.3,20.3,-225.2C58,-253.2,116,-246.3,134.4,-209Z",
  //       },
  //       {
  //         value:
  //           "M91.2,-109.9C130.7,-96.8,183.7,-86.9,204.4,-58.2C225.1,-29.5,213.4,18,198.1,64.2C182.8,110.3,164,155.1,130.4,174.1C96.8,193.2,48.4,186.6,-4.7,193.1C-57.8,199.6,-115.6,219.1,-133.2,194.8C-150.8,170.5,-128.2,102.4,-140,49.4C-151.9,-3.6000000000000014,-198.1,-41.5,-195.6,-68C-193.1,-94.5,-141.8,-109.5,-101.1,-122.1C-60.3,-134.7,-30.2,-144.9,-2.200000000000001,-141.9C25.9,-138.9,51.7,-122.9,91.2,-109.9Z",
  //       },
  //       {
  //         value:
  //           "M68.5,-117.9C81.3,-84.9,79.2,-55,98.9,-24.9C118.6,5.2,160.1,35.3,170.4,71.3C180.7,107.3,159.7,149.1,126.1,161.4C92.5,173.6,46.2,156.3,16.4,133.8C-13.5,111.3,-27,83.5,-46.7,66.8C-66.3,50,-92.1,44.2,-111.5,26.4C-130.9,8.5,-143.9,-21.2,-140,-49.3C-136.2,-77.4,-115.4,-103.8,-89.2,-132.5C-63.1,-161.2,-31.5,-192.1,-1.9,-189.5C27.8,-187,55.6,-150.9,68.5,-117.9Z",
  //       },
  //     ],
  //     easing: "easeOutQuad",
  //     duration: 33000,
  //     loop: true,
  //   });
  // }, []);

  return (
    <>
      <div className={style.container} ref={containerRef}>
        <div className={style.calculatorContainer}>
          <div className={style.topSvgContainer}>
            <svg width="100%" height="100%" viewBox="0 0 600 600">
              <g transform="translate(300, 300)">
                <path
                  className="top-path"
                  d="M136.6,-181.3C183.8,-153.7,233.59999999999997,-122.9,248.4,-80.1C263.1,-37.3,242.8,17.5,201.7,41.2C160.5,64.9,98.5,57.5,61.400000000000006,61.5C24.299999999999997,65.4,12.100000000000001,80.7,-21.5,110.2C-55.1,139.8,-110.1,183.6,-132.6,174.9C-155.1,166.2,-145.1,105,-151.3,56.2C-157.6,7.3,-180.1,-29.3,-167.1,-49.6C-154.1,-70,-105.5,-74.3,-71.8,-106.3C-38,-138.3,-19,-198.2,12.8,-215.8C44.7,-233.5,89.3,-209,136.6,-181.3Z"
                  fill={"rgba(204, 52, 112, 1)"}
                  stroke="none"
                  strokeWidth="0"
                ></path>
              </g>
            </svg>
          </div>
          <div className={style.svgContainer}>
            <svg width="100%" height="100%" viewBox="0 0 500 500">
              <g transform="translate(250, 250)">
                <path
                  className="path"
                  id="clippingPath"
                  d="M114,-157.7C152.3,-129,191.3,-101.9,194.1,-68.8C196.9,-35.7,163.6,3.3,137.8,33C111.9,62.7,93.6,83.1,71.9,99.6C50.2,116,25.1,128.5,-9.200000000000001,141.2C-43.5,153.9,-87,166.7,-107.4,149.9C-127.9,133,-125.3,86.4,-148.6,41.9C-171.8,-2.6999999999999993,-221,-45.2,-224.5,-84.9C-228.1,-124.6,-186,-161.4,-141,-187.9C-96,-214.5,-48,-230.7,-5.1,-223.7C37.8,-216.7,75.6,-186.4,114,-157.7Z"
                  fill="#03dac6"
                  stroke="none"
                  strokeWidth="0"
                ></path>
              </g>
            </svg>
          </div>

          <div className={style.contentContainer}>
            <h2 className={style.title}>Lønnskalkulator</h2>

            <p>
              Vil du vite hva du vil tjene hos oss? Svar på to enkle spørsmål:
            </p>

            <div>
              <div className={style.question}>Si oss hvilken grad du har?</div>

              <RadioButton
                changed={setDegree}
                id="degree-1"
                isSelected={degree === "bachelor"}
                label="Bachelor"
                value="bachelor"
              />

              <RadioButton
                changed={setDegree}
                id="degree-2"
                isSelected={degree === "masters"}
                label="Master"
                value="masters"
              />
            </div>

            <div className={style.barSliderContainer}>
              <div className={style.question}>
                Når ble du ferdig med graden?
              </div>

              <span
                className={style.icon}
                aria-label="Grown lady icon"
                role="img"
              >
                <span role="img" aria-label="Icon of an old lady">
                  👵
                </span>
              </span>
              <Slider
                initial={selectedYear}
                to={maxYear}
                from={1990}
                onChange={setSelectedYear}
              />
              <span className={style.icon} aria-label="Child icon" role="img">
                <span role="img" aria-label="Icon of a child">
                  👶
                </span>
              </span>
            </div>

            <footer className={style.footer}>
              <div className={style.calculation}>
                <div className={style.question}>Da blir lønnen din sånn:</div>
                <div className={style.flexRow}>
                  <span>Utdanning</span>
                  <span>{degree == "masters" ? 5 : 3} år</span>
                </div>
                <div className={style.flexRow}>
                  <span>Erfaring</span>
                  <span>{maxYear - selectedYear} år</span>
                </div>
                <div className={style.flexRow}>
                  <span>Din årslønn i Variant</span>
                  <span className="result">{salary}</span>
                </div>
              </div>
            </footer>
          </div>
        </div>
      </div>
    </>
  );
};
